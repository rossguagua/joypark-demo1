<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¿æ¥æµ‹è¯• - é…’å®å…¬å›­</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f0f0f;
            color: white;
            padding: 20px;
        }
        .test-box {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
        }
        .success { border-color: #22c55e; background: #052e16; }
        .error { border-color: #ef4444; background: #450a0a; }
        .warning { border-color: #f59e0b; background: #451a03; }
        .loading { border-color: #3b82f6; background: #1e3a8a; }
        .log {
            background: #111;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            padding: 12px;
            border-radius: 4px;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="max-w-4xl mx-auto">
        <h1 class="text-2xl font-bold mb-6">ğŸ” æ•°æ®åº“è¿æ¥ä¿®å¤æµ‹è¯•</h1>
        
        <div class="test-box loading" id="supabaseTest">
            <h2 class="text-lg font-semibold mb-2">ğŸ—„ï¸ Supabaseæ¨¡å—æµ‹è¯•</h2>
            <div id="supabaseResult">æ­£åœ¨æµ‹è¯•...</div>
        </div>

        <div class="test-box loading" id="analyticsTest">
            <h2 class="text-lg font-semibold mb-2">ğŸ“Š Analyticsæ¨¡å—æµ‹è¯•</h2>
            <div id="analyticsResult">æ­£åœ¨æµ‹è¯•...</div>
        </div>

        <div class="test-box loading" id="offlineTest">
            <h2 class="text-lg font-semibold mb-2">ğŸ”Œ ç¦»çº¿æ¨¡å—æµ‹è¯•</h2>
            <div id="offlineResult">æ­£åœ¨æµ‹è¯•...</div>
        </div>

        <div class="test-box loading" id="dataTest">
            <h2 class="text-lg font-semibold mb-2">ğŸ® æ•°æ®åŠ è½½æµ‹è¯•</h2>
            <div id="dataResult">æ­£åœ¨æµ‹è¯•...</div>
        </div>

        <div class="test-box">
            <h2 class="text-lg font-semibold mb-2">ğŸ¯ å¿«é€Ÿæ“ä½œ</h2>
            <div class="space-y-2">
                <button onclick="testBasicConnection()" class="bg-blue-600 text-white px-4 py-2 rounded mr-2">æµ‹è¯•åŸºç¡€è¿æ¥</button>
                <button onclick="testAnalytics()" class="bg-green-600 text-white px-4 py-2 rounded mr-2">æµ‹è¯•åˆ†æç³»ç»Ÿ</button>
                <button onclick="window.open('index.html', '_blank')" class="bg-purple-600 text-white px-4 py-2 rounded mr-2">æ‰“å¼€æ¸¸æˆåº“</button>
                <button onclick="window.open('drinking-game.html', '_blank')" class="bg-orange-600 text-white px-4 py-2 rounded">æ‰“å¼€é¥®é…’æ¸¸æˆ</button>
            </div>
        </div>

        <div class="test-box">
            <h2 class="text-lg font-semibold mb-2">ğŸ“‹ æµ‹è¯•æ—¥å¿—</h2>
            <div id="logs" class="log"></div>
        </div>
    </div>

    <script type="module">
        let logs = [];

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            logs.push(logEntry);
            
            const logElement = document.getElementById('logs');
            logElement.textContent = logs.join('\n');
            logElement.scrollTop = logElement.scrollHeight;
            
            console.log(logEntry);
        }

        function updateTestResult(testId, result, status = 'success') {
            const element = document.getElementById(testId);
            const resultElement = document.getElementById(testId.replace('Test', 'Result'));
            
            element.className = element.className.replace(/\b(success|error|warning|loading)\b/g, '');
            element.classList.add(status);
            
            resultElement.innerHTML = result;
        }

        // æµ‹è¯•Supabaseæ¨¡å—
        async function testSupabase() {
            try {
                log('å¼€å§‹æµ‹è¯•Supabaseæ¨¡å—...');
                const supabaseModule = await import('./src/lib/supabase.js');
                log('âœ… Supabaseæ¨¡å—å¯¼å…¥æˆåŠŸ');
                
                // æµ‹è¯•è·å–æ¸¸æˆæ•°æ®
                const games = await supabaseModule.getGames();
                log(`âœ… æˆåŠŸè·å– ${games.length} ä¸ªæ¸¸æˆ`);
                
                updateTestResult('supabaseTest', `
                    <div>âœ… æ¨¡å—åŠ è½½: æˆåŠŸ</div>
                    <div>âœ… æ•°æ®è·å–: ${games.length} ä¸ªæ¸¸æˆ</div>
                    <div>âœ… è¿æ¥çŠ¶æ€: æ­£å¸¸</div>
                `, 'success');
                
                return true;
            } catch (error) {
                log(`âŒ Supabaseæµ‹è¯•å¤±è´¥: ${error.message}`);
                updateTestResult('supabaseTest', `
                    <div>âŒ é”™è¯¯: ${error.message}</div>
                    <div>âš ï¸ å°†ä½¿ç”¨ç¦»çº¿æ¨¡å¼</div>
                `, 'error');
                return false;
            }
        }

        // æµ‹è¯•Analyticsæ¨¡å—
        async function testAnalytics() {
            try {
                log('å¼€å§‹æµ‹è¯•Analyticsæ¨¡å—...');
                const analyticsModule = await import('./src/lib/analytics.js');
                log('âœ… Analyticsæ¨¡å—å¯¼å…¥æˆåŠŸ');
                
                // æµ‹è¯•äº‹ä»¶è¿½è¸ª
                analyticsModule.trackEvent('TEST_EVENT', { test: true });
                log('âœ… æµ‹è¯•äº‹ä»¶å‘é€æˆåŠŸ');
                
                updateTestResult('analyticsTest', `
                    <div>âœ… æ¨¡å—åŠ è½½: æˆåŠŸ</div>
                    <div>âœ… äº‹ä»¶è¿½è¸ª: æ­£å¸¸</div>
                    <div>ğŸ“Š æµ‹è¯•äº‹ä»¶å·²å‘é€</div>
                `, 'success');
                
                return true;
            } catch (error) {
                log(`âŒ Analyticsæµ‹è¯•å¤±è´¥: ${error.message}`);
                updateTestResult('analyticsTest', `
                    <div>âŒ é”™è¯¯: ${error.message}</div>
                    <div>âš ï¸ åˆ†æåŠŸèƒ½å°†ç¦»çº¿è¿è¡Œ</div>
                `, 'warning');
                return false;
            }
        }

        // æµ‹è¯•ç¦»çº¿æ¨¡å—
        async function testOffline() {
            try {
                log('å¼€å§‹æµ‹è¯•ç¦»çº¿æ¨¡å—...');
                const offlineModule = await import('./src/lib/offline-fallback.js');
                log('âœ… ç¦»çº¿æ¨¡å—å¯¼å…¥æˆåŠŸ');
                
                // æµ‹è¯•ç¦»çº¿æ•°æ®
                const cardIds = offlineModule.getOfflineCardIds('mildmode');
                const gameData = offlineModule.fallbackGameData;
                
                log(`âœ… ç¦»çº¿æ•°æ®å¯ç”¨: ${cardIds.length} å¼ å¡ç‰‡`);
                
                updateTestResult('offlineTest', `
                    <div>âœ… æ¨¡å—åŠ è½½: æˆåŠŸ</div>
                    <div>âœ… æ¸¸æˆæ•°æ®: å¯ç”¨</div>
                    <div>âœ… å¡ç‰‡æ•°æ®: ${cardIds.length} å¼ </div>
                `, 'success');
                
                return true;
            } catch (error) {
                log(`âŒ ç¦»çº¿æ¨¡å—æµ‹è¯•å¤±è´¥: ${error.message}`);
                updateTestResult('offlineTest', `
                    <div>âŒ é”™è¯¯: ${error.message}</div>
                    <div>ğŸš« ç¦»çº¿åŠŸèƒ½ä¸å¯ç”¨</div>
                `, 'error');
                return false;
            }
        }

        // ç»¼åˆæ•°æ®åŠ è½½æµ‹è¯•
        async function testDataLoading() {
            try {
                log('å¼€å§‹ç»¼åˆæ•°æ®åŠ è½½æµ‹è¯•...');
                
                // æ¨¡æ‹Ÿæ¸¸æˆæ•°æ®åŠ è½½æµç¨‹
                const offlineModule = await import('./src/lib/offline-fallback.js');
                
                // æµ‹è¯•æ··åˆæ¨¡å¼å‡½æ•°
                const gameData = await offlineModule.hybridGetGameData('drinking-topics');
                const cardIds = await offlineModule.hybridGetGameCardIds('1', 'mildmode');
                
                if (cardIds.length > 0) {
                    const firstCard = await offlineModule.hybridGetCardById(cardIds[0]);
                    log(`âœ… æˆåŠŸè·å–å¡ç‰‡: ${firstCard.content.substring(0, 20)}...`);
                }
                
                updateTestResult('dataTest', `
                    <div>âœ… æ¸¸æˆæ•°æ®: ${gameData.name}</div>
                    <div>âœ… å¡ç‰‡ID: ${cardIds.length} ä¸ª</div>
                    <div>âœ… æ··åˆæ¨¡å¼: æ­£å¸¸å·¥ä½œ</div>
                `, 'success');
                
                log('âœ… ç»¼åˆæµ‹è¯•é€šè¿‡ï¼Œåº”ç”¨åº”è¯¥èƒ½æ­£å¸¸å·¥ä½œ');
                
            } catch (error) {
                log(`âŒ æ•°æ®åŠ è½½æµ‹è¯•å¤±è´¥: ${error.message}`);
                updateTestResult('dataTest', `
                    <div>âŒ é”™è¯¯: ${error.message}</div>
                    <div>ğŸš« æ•°æ®åŠ è½½å¤±è´¥</div>
                `, 'error');
            }
        }

        // å…¨å±€æµ‹è¯•å‡½æ•°
        window.testBasicConnection = async function() {
            log('ğŸš€ å¼€å§‹åŸºç¡€è¿æ¥æµ‹è¯•...');
            const supabaseOK = await testSupabase();
            if (supabaseOK) {
                log('âœ… åŸºç¡€è¿æ¥æµ‹è¯•é€šè¿‡');
                alert('âœ… æ•°æ®åº“è¿æ¥æ­£å¸¸ï¼');
            } else {
                log('âš ï¸ åŸºç¡€è¿æ¥å¤±è´¥ï¼Œä½†åº”ç”¨ä»å¯ä½¿ç”¨ç¦»çº¿æ¨¡å¼');
                alert('âš ï¸ æ•°æ®åº“è¿æ¥å¤±è´¥ï¼Œä½†åº”ç”¨ä»å¯ç”¨');
            }
        };

        window.testAnalytics = async function() {
            log('ğŸš€ å¼€å§‹åˆ†æç³»ç»Ÿæµ‹è¯•...');
            const analyticsOK = await testAnalytics();
            if (analyticsOK) {
                log('âœ… åˆ†æç³»ç»Ÿæµ‹è¯•é€šè¿‡');
                alert('âœ… åˆ†æç³»ç»Ÿæ­£å¸¸å·¥ä½œï¼');
            } else {
                log('âš ï¸ åˆ†æç³»ç»Ÿç¦»çº¿ï¼Œä½†ä¸å½±å“æ¸¸æˆåŠŸèƒ½');
                alert('âš ï¸ åˆ†æç³»ç»Ÿç¦»çº¿è¿è¡Œ');
            }
        };

        // è¿è¡Œæ‰€æœ‰æµ‹è¯•
        async function runAllTests() {
            log('ğŸ¯ å¼€å§‹è¿è¡Œæ‰€æœ‰ä¿®å¤éªŒè¯æµ‹è¯•...');
            
            await testSupabase();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testAnalytics();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testOffline();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testDataLoading();
            
            log('ğŸ‰ æ‰€æœ‰æµ‹è¯•å®Œæˆï¼æ£€æŸ¥ä¸Šé¢çš„ç»“æœã€‚');
        }

        // é¡µé¢åŠ è½½åè‡ªåŠ¨è¿è¡Œæµ‹è¯•
        runAllTests();
    </script>
</body>
</html> 