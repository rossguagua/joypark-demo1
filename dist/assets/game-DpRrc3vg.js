const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/offline-fallback-CiPykxTm.js","assets/preload-helper-CS1eXPs2.js","assets/analytics-CZ3OqPXu.js"])))=>i.map(i=>d[i]);
import{_ as x}from"./preload-helper-CS1eXPs2.js";let w,h,v,r={},b={},E={},l="mildmode",f=null,T=!1,c={},d=!1,i=["mildmode","ontheedge","intense","surprise"],g=!1;const S={surprise:"盲盒 Surprise Me",intense:"加麻加辣 Intense",ontheedge:"微辣 On the Edge",mildmode:"清汤 Mild Mode"};function C(e){const t=document.querySelector(".network-status-notification");t&&t.remove();let o,a;if(e==="offline")o="🔌 离线模式：使用本地数据，功能有限",a="bg-orange-600";else if(e==="online")o="🌐 在线模式：正在使用最新数据",a="bg-green-600";else return;const n=document.createElement("div");n.className=`network-status-notification fixed top-4 left-4 right-4 ${a} text-white p-3 rounded-lg z-50 text-center`,n.innerHTML=o,document.body.appendChild(n),setTimeout(()=>{document.body.contains(n)&&(n.style.opacity="0",n.style.transition="opacity 0.5s",setTimeout(()=>{document.body.contains(n)&&document.body.removeChild(n)},500))},3e3)}window.addEventListener("online",()=>{if(console.log("网络连接已恢复"),document.getElementById("errorState").style.display==="block"){const e=document.createElement("div");e.className="fixed top-4 left-4 right-4 bg-green-600 text-white p-3 rounded-lg z-50",e.innerHTML="🌐 网络连接已恢复，可以重新加载游戏",document.body.appendChild(e),setTimeout(()=>{document.body.removeChild(e)},3e3)}});window.addEventListener("offline",()=>{console.log("网络连接已断开");const e=document.createElement("div");e.className="fixed top-4 left-4 right-4 bg-red-600 text-white p-3 rounded-lg z-50",e.innerHTML="⚠️ 网络连接已断开，部分功能可能不可用",document.body.appendChild(e),setTimeout(()=>{document.body.contains(e)&&document.body.removeChild(e)},5e3)});(async function(){try{console.log("🚀 开始初始化游戏模块...");let t=null,o=null;try{t=await x(()=>import("./offline-fallback-CiPykxTm.js"),__vite__mapDeps([0,1])),console.log("✅ 离线模块加载成功")}catch(a){throw console.error("❌ 离线模块加载失败:",a.message),new Error("离线模块是必需的，初始化失败")}try{o=await x(()=>import("./analytics-CZ3OqPXu.js"),__vite__mapDeps([2,1])),window.trackEvent=o.trackEvent,console.log("✅ Analytics模块加载成功")}catch(a){console.warn("⚠️ Analytics模块加载失败:",a.message),window.trackEvent=function(n,s){console.log("📊 Analytics离线模式:",n,s)}}w=t.hybridGetGameCardIds,h=t.hybridGetCardById,v=t.hybridGetGameData,console.log("✅ 混合模式模块设置成功"),navigator.onLine?console.log("🌐 网络连接正常，将优先使用在线数据"):(console.log("🔌 检测到离线状态，将使用离线数据"),C&&C("offline")),await L()}catch(t){console.error("❌ 初始化失败:",t.message);try{if(console.log("🔌 尝试纯离线模式..."),typeof fallbackCards<"u"){console.log("✅ 检测到fallback数据，使用纯离线模式"),w=function(o,a){return Promise.resolve(getOfflineCardIds?getOfflineCardIds(a):[])},h=function(o){return Promise.resolve(getOfflineCardById?getOfflineCardById(o):null)},v=function(o){return Promise.resolve(fallbackGameData||null)},window.trackEvent=function(o,a){console.log("📊 Analytics完全离线模式:",o,a)},await L(),console.log("✅ 纯离线模式启动成功");return}throw new Error("无可用的离线数据")}catch(o){console.error("❌ 所有初始化尝试都失败:",o.message),document.getElementById("loadingState").style.display="none",document.getElementById("errorState").style.display="block",document.getElementById("errorState").innerHTML=`
              <div class="text-center py-8">
                <p class="mb-4 text-lg">🚫 初始化失败</p>
                <p class="text-sm text-gray-400 mb-2">原因: ${t.message}</p>
                <p class="text-sm text-gray-400 mb-6">所有启动方式都失败了</p>
                <div class="space-y-3">
                  <button onclick="location.reload()" class="bg-red-500 text-white px-6 py-2 rounded-lg block w-full">重新加载</button>
                  <button onclick="window.history.back()" class="bg-gray-600 text-white px-6 py-2 rounded-lg block w-full">返回游戏库</button>
                </div>
              </div>
            `}}})();function $(e){r[e]&&(b[e]=[...r[e]],E[e]=[],c[e]=0)}function M(){const e=document.querySelector(`.stacked-card[data-category='${i[0]}']`);i.push(i.shift()),l=i[0],i.forEach((t,o)=>{const a=document.querySelector(`.stacked-card[data-category='${t}']`);if(a)if(a.classList.remove("slide-out-up","slide-out-down","slide-out-left","slide-out-right"),o===0)a.style.transform="translateY(0px) scale(1)",a.style.zIndex=10,a.style.opacity="1",a.style.pointerEvents="auto";else{const n=o*10,s=o*-45,u=1-o*.04;a.style.transform=`translate(${n}px, ${s}px) scale(${u})`,a.style.zIndex=10-o,a.style.opacity="1",a.style.pointerEvents="none"}}),e&&(e.style.display="none",setTimeout(()=>{e.style.display==="none"&&(e.style.display="block",e.style.opacity="1")},100)),g=!1}function p(e){if(g)return;g=!0;const t=document.querySelector(`.stacked-card[data-category='${i[0]}']`);if(!t){g=!1;return}t.classList.add(`slide-out-${e}`),t.addEventListener("animationend",M,{once:!0})}function B(){l=i[0];const e=document.querySelector(`.stacked-card[data-category='${l}']`);if(!e)return;const t=e.querySelector(".topic-text");T||(t.classList.remove("topic-fade-in"),t.classList.add("topic-fade-out"),setTimeout(()=>{t.textContent="点击卡片开始",t.classList.remove("topic-fade-out"),t.classList.add("topic-fade-in")},300))}async function _(e){if(!r[e]||r[e].length===0||(c[e]===void 0&&(c[e]=0),c[e]>=r[e].length))return null;const t=r[e][c[e]];c[e]++;try{return await h(t)}catch(o){return console.error("Error fetching card by ID:",o),null}}async function k(){if(d)return;if(d=!0,T=!0,!r[l]){const o=document.querySelector(`.stacked-card[data-category='${l}']`);if(o){const a=o.querySelector(".topic-text");a.textContent="话题数据未加载或类型不存在。"}d=!1;return}const e=document.querySelector(`.stacked-card[data-category='${l}']`);if(!e){d=!1;return}const t=e.querySelector(".topic-text");t.classList.remove("topic-fade-in"),t.classList.add("topic-fade-out"),setTimeout(async()=>{try{const o=await _(l);if(o===null){O(),d=!1;return}window.trackEvent&&window.trackEvent("TOPIC_DRAW",{category:l}),t.textContent=o.content,t.classList.remove("topic-fade-out"),t.classList.add("topic-fade-in"),setTimeout(()=>{d=!1},600)}catch(o){console.error("Error displaying new topic:",o),t.textContent="加载话题失败，请重试",t.classList.remove("topic-fade-out"),t.classList.add("topic-fade-in"),setTimeout(()=>{d=!1},600)}},300)}function O(){const e=document.getElementById("completionModal"),t=document.getElementById("completedCount"),o=document.getElementById("currentCategoryName");t.textContent=r[l].length,o.textContent=S[l],window.trackEvent&&window.trackEvent("CATEGORY_COMPLETE",{category:l}),e.classList.add("active"),document.body.style.overflow="hidden"}window.closeCompletionModal=function(){document.getElementById("completionModal").classList.remove("active"),document.body.style.overflow=""};window.restartCategory=function(){window.trackEvent&&window.trackEvent("CATEGORY_RESTART",{category:l}),$(l),closeCompletionModal();const e=document.querySelector(`.stacked-card[data-category='${l}']`);if(e){const t=e.querySelector(".topic-text");t.classList.remove("topic-fade-in"),t.classList.add("topic-fade-out"),setTimeout(()=>{t.textContent="点击继续新一轮",t.classList.remove("topic-fade-out"),t.classList.add("topic-fade-in")},300)}};document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector(".card-stack");if(!e)return;let t=0,o=0,a=!1;e.addEventListener("mousedown",n=>{n.target.closest(".stacked-card")===document.querySelector(`.stacked-card[data-category='${i[0]}']`)&&(t=n.clientX,o=n.clientY,a=!0)}),e.addEventListener("mousemove",n=>{a&&n.preventDefault()}),e.addEventListener("mouseup",n=>{if(!a)return;a=!1;const s=n.clientX-t,u=n.clientY-o;Math.abs(s)>50||Math.abs(u)>50?p("next"):k()}),e.addEventListener("touchstart",n=>{n.target.closest(".stacked-card")===document.querySelector(`.stacked-card[data-category='${i[0]}']`)&&(t=n.touches[0].clientX,o=n.touches[0].clientY,a=!0)}),e.addEventListener("touchend",n=>{if(!a)return;a=!1;const s=n.changedTouches[0].clientX,u=n.changedTouches[0].clientY,m=s-t,y=u-o;if(Math.abs(m)<50&&Math.abs(y)<50){k();return}Math.abs(m)>Math.abs(y)?p(m>0?"right":"left"):p(y>0?"down":"up")})});window.goBack=function(){window.location.href="index.html"};document.getElementById("completionModal").addEventListener("click",function(e){e.target===this&&closeCompletionModal()});document.addEventListener("keydown",function(e){e.key==="Escape"&&closeCompletionModal()});function q(){if(!navigator.onLine)throw new Error("网络连接已断开，请检查网络连接后重试");if(navigator.connection){const e=navigator.connection;(e.effectiveType==="slow-2g"||e.effectiveType==="2g")&&console.warn("检测到慢速网络连接，可能需要更长加载时间")}}async function L(){try{q(),console.log("Loading game data from database...");const e=performance.now();if(console.log("🔄 正在获取游戏数据..."),f=await v("drinking-topics"),!f)throw new Error("Game not found with category_tag: drinking-topics");console.log("Game data loaded:",f);const t=Object.keys(S).map(async n=>{console.log(`Loading card IDs for category: ${n}`);try{console.log(`🔄 正在加载 ${n} 分类的卡片...`);const s=await w(f.id,n);return console.log(`✅ 成功加载 ${s.length} 张 ${n} 卡片`),r[n]=s,b[n]=[...s],E[n]=[],c[n]=0,{categoryId:n,count:s.length}}catch(s){return console.warn(`Failed to load cards for ${n}:`,s),r[n]=[],b[n]=[],E[n]=[],c[n]=0,{categoryId:n,count:0}}}),o=await Promise.all(t),a=performance.now()-e;console.log(`All card IDs loaded in ${a.toFixed(2)}ms:`,o),document.getElementById("loadingState").style.display="none",document.getElementById("gameContainer").style.display="flex",M(),B()}catch(e){console.error("Error loading game data:",e),document.getElementById("loadingState").style.display="none",document.getElementById("errorState").style.display="block";let t=e.message,o="";e.message.includes("timeout")||e.message.includes("超时")?o=`
              <div class="mt-4 p-3 bg-yellow-900/20 border border-yellow-500/30 rounded-lg">
                <p class="text-yellow-400 text-sm mb-2">💡 网络连接建议：</p>
                <ul class="text-gray-300 text-xs space-y-1">
                  <li>• 尝试切换到更稳定的WiFi网络</li>
                  <li>• 如使用移动数据，请确保信号良好</li>
                  <li>• 稍等片刻后重试，服务器可能暂时繁忙</li>
                </ul>
              </div>
            `:e.message.includes("网络连接已断开")&&(o=`
              <div class="mt-4 p-3 bg-red-900/20 border border-red-500/30 rounded-lg">
                <p class="text-red-400 text-sm mb-2">🔌 请检查网络连接</p>
                <ul class="text-gray-300 text-xs space-y-1">
                  <li>• 确保设备已连接到互联网</li>
                  <li>• 尝试打开其他网页确认网络正常</li>
                </ul>
              </div>
            `),document.getElementById("errorState").innerHTML=`
            <div class="text-center">
              <p class="mb-4 text-lg">😕 加载游戏数据失败</p>
              <p class="text-sm text-gray-400 mb-4">错误详情: ${t}</p>
              ${o}
              <div class="mt-6 space-y-3">
                <button onclick="location.reload()" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg transition-colors w-full">
                  🔄 重新加载
                </button>
                <button onclick="window.location.href='index.html'" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded-lg transition-colors w-full">
                  ⬅️ 返回游戏库
                </button>
              </div>
            </div>
          `}}
