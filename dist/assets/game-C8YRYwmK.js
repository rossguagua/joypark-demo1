const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/supabase-BR-AoxQ-.js","assets/preload-helper-CS1eXPs2.js"])))=>i.map(i=>d[i]);
import{_ as v}from"./preload-helper-CS1eXPs2.js";let y,h,E,l={},i={},f={},d="mildmode",m=null,c=["mildmode","ontheedge","intense","surprise"],u=!1;const C={surprise:"盲盒 Surprise Me",intense:"加麻加辣 Intense",ontheedge:"微辣 On the Edge",mildmode:"清汤 Mild Mode"};(async function(){try{const e=await v(()=>import("./supabase-BR-AoxQ-.js"),__vite__mapDeps([0,1]));y=e.getGameCardIds,h=e.getCardById,E=e.getGameByCategoryTag,console.log("✅ Supabase模块加载成功"),await T()}catch(e){console.error("❌ 初始化失败:",e),document.getElementById("loadingState").style.display="none",document.getElementById("errorState").style.display="block",document.getElementById("errorState").innerHTML=`
            <p class="mb-4">游戏初始化失败</p>
            <p class="text-sm text-gray-400 mb-4">错误: ${e.message}</p>
            <button onclick="location.reload()" class="bg-red-500 text-white px-4 py-2 rounded">重试</button>
          `}})();function k(t){l[t]&&(i[t]=[...l[t]],f[t]=[])}function L(){c.forEach((t,e)=>{const o=document.querySelector(`.stacked-card[data-category='${t}']`);if(o)if(o.classList.remove("slide-left","slide-right","slide-in-from-left"),e===0)o.style.transform="translateY(0px) scale(1)",o.style.zIndex=10,o.style.opacity="1",o.style.pointerEvents="auto";else{const a=e*-15,n=1-e*.05;o.style.transform=`translateY(${a}px) scale(${n})`,o.style.zIndex=10-e,o.style.opacity="1",o.style.pointerEvents="none"}})}function p(t){if(u)return;u=!0;const e=document.querySelector(`.stacked-card[data-category='${c[0]}']`);if(!e){u=!1;return}const o=(a=!1)=>{a?c.unshift(c.pop()):c.push(c.shift()),L(),w(),u=!1};if(t==="right")e.classList.add("slide-right"),e.addEventListener("animationend",()=>o(!1),{once:!0});else{const a=c[c.length-1],n=document.querySelector(`.stacked-card[data-category='${a}']`);e.classList.add("slide-right"),n.classList.add("slide-in-from-left"),n.addEventListener("animationend",()=>o(!0),{once:!0})}}function w(){d=c[0];const t=document.querySelector(`.stacked-card[data-category='${d}']`);if(!t)return;const e=t.querySelector(".topic-text");e.classList.remove("topic-fade-in"),e.classList.add("topic-fade-out"),setTimeout(()=>{e.textContent="点击卡片开始",e.classList.remove("topic-fade-out"),e.classList.add("topic-fade-in")},300)}async function b(t){if(!i[t]||i[t].length===0)return null;const e=Math.floor(Math.random()*i[t].length),o=i[t][e];i[t].splice(e,1),f[t].push(o);try{return await h(o)}catch(a){return console.error("Error fetching card by ID:",a),null}}async function g(){if(!l[d]){const o=document.querySelector(`.stacked-card[data-category='${d}']`);if(o){const a=o.querySelector(".topic-text");a.textContent="话题数据未加载或类型不存在。"}return}const t=document.querySelector(`.stacked-card[data-category='${d}']`);if(!t)return;const e=t.querySelector(".topic-text");e.classList.remove("topic-fade-in"),e.classList.add("topic-fade-out"),setTimeout(async()=>{try{const o=await b(d);if(o===null){S();return}e.textContent=o.content,e.classList.remove("topic-fade-out"),e.classList.add("topic-fade-in")}catch(o){console.error("Error displaying new topic:",o),e.textContent="加载话题失败，请重试",e.classList.remove("topic-fade-out"),e.classList.add("topic-fade-in")}},300)}function S(){const t=document.getElementById("completionModal"),e=document.getElementById("completedCount"),o=document.getElementById("currentCategoryName");e.textContent=l[d].length,o.textContent=C[d],t.classList.add("active"),document.body.style.overflow="hidden"}window.closeCompletionModal=function(){document.getElementById("completionModal").classList.remove("active"),document.body.style.overflow=""};window.restartCategory=function(){k(d),closeCompletionModal(),topicTextElement.classList.remove("topic-fade-in"),topicTextElement.classList.add("topic-fade-out"),setTimeout(()=>{topicTextElement.textContent="点击卡片开始新一轮",topicTextElement.classList.remove("topic-fade-out"),topicTextElement.classList.add("topic-fade-in")},300)};document.addEventListener("DOMContentLoaded",()=>{const t=document.querySelector(".card-stack");if(!t)return;let e=0,o=0,a=!1;t.addEventListener("mousedown",n=>{n.target.closest(".stacked-card")===document.querySelector(`.stacked-card[data-category='${c[0]}']`)&&(e=n.clientX,o=n.clientY,a=!0)}),t.addEventListener("mousemove",n=>{a&&n.preventDefault()}),t.addEventListener("mouseup",n=>{if(!a)return;a=!1;const s=n.clientX-e,r=n.clientY-o;Math.abs(s)<50?g():Math.abs(s)>Math.abs(r)&&p(s>0?"right":"left")}),t.addEventListener("touchstart",n=>{n.target.closest(".stacked-card")===document.querySelector(`.stacked-card[data-category='${c[0]}']`)&&(e=n.touches[0].clientX,o=n.touches[0].clientY,a=!0)}),t.addEventListener("touchend",n=>{if(!a)return;a=!1;const r=n.changedTouches[0].clientX-e;Math.abs(r)<50?g():p(r>0?"right":"left")})});window.goBack=function(){window.location.href="index.html"};document.getElementById("completionModal").addEventListener("click",function(t){t.target===this&&closeCompletionModal()});document.addEventListener("keydown",function(t){t.key==="Escape"&&closeCompletionModal()});async function T(){try{console.log("Loading game data from database...");const t=performance.now(),e=new Promise((s,r)=>{setTimeout(()=>r(new Error("Database connection timeout")),1e4)});if(m=await Promise.race([E("drinking-topics"),e]),!m)throw new Error("Game not found with category_tag: drinking-topics");console.log("Game data loaded:",m);const o=Object.keys(C).map(async s=>{console.log(`Loading card IDs for category: ${s}`);try{const r=await Promise.race([y(m.id,s),new Promise((M,x)=>setTimeout(()=>x(new Error("Card loading timeout")),5e3))]);return console.log(`Loaded ${r.length} card IDs for ${s}`),l[s]=r,i[s]=[...r],f[s]=[],{categoryId:s,count:r.length}}catch(r){return console.warn(`Failed to load cards for ${s}:`,r),l[s]=[],i[s]=[],f[s]=[],{categoryId:s,count:0}}}),a=await Promise.all(o),n=performance.now()-t;console.log(`All card IDs loaded in ${n.toFixed(2)}ms:`,a),document.getElementById("loadingState").style.display="none",document.getElementById("gameContainer").style.display="flex",L(),w()}catch(t){console.error("Error loading game data:",t),document.getElementById("loadingState").style.display="none",document.getElementById("errorState").style.display="block",document.getElementById("errorState").innerHTML=`
            <p class="mb-4">加载游戏数据失败</p>
            <p class="text-sm text-gray-400 mb-4">错误: ${t.message}</p>
            <button onclick="location.reload()" class="bg-red-500 text-white px-4 py-2 rounded">重试</button>
          `}}
