import{a as I,b as w}from"./supabase-Bwuv_4SX.js";let u={},m={},g={},a="mildmode";const d=document.getElementById("topic-card"),n=document.getElementById("topic-text"),B=document.getElementById("refresh-button"),T=document.getElementById("progressIndicator"),C=Array.from(document.querySelectorAll(".category-selector")),i=["mildmode","ontheedge","intense","surprise"],v={surprise:"盲盒 Surprise Me",intense:"加麻加辣 Intense",ontheedge:"微辣 On the Edge",mildmode:"清汤 Mild Mode"},f={surprise:{mainCardColor:"bg-[#FFC9DC]",mainCardTextColor:"text-black"},intense:{mainCardColor:"bg-[#B8B4FF]",mainCardTextColor:"text-black"},ontheedge:{mainCardColor:"bg-[#A0E7E5]",mainCardTextColor:"text-black"},mildmode:{mainCardColor:"bg-[#C8FD0B]",mainCardTextColor:"text-black"}},k={surprise:{left:"calc(50% - 132px)"},intense:{left:"calc(50% - 140px)"},ontheedge:{left:"calc(50% - 148px)"},mildmode:{left:"calc(50% - 158px)"}};C.forEach(t=>{const e=t.dataset.categoryId;t.style.left=k[e].left});async function D(){try{console.log("Loading game card IDs from database...");const t=performance.now(),e=Object.keys(v).map(async s=>{console.log(`Loading card IDs for category: ${s}`);const r=await I("drinking-topics",s);return console.log(`Loaded ${r.length} card IDs for ${s}`),u[s]=r,m[s]=[...r],g[s]=[],{categoryId:s,count:r.length}}),c=await Promise.all(e),o=performance.now()-t;console.log(`All card IDs loaded in ${o.toFixed(2)}ms:`,c),document.getElementById("loadingState").style.display="none",document.getElementById("gameContainer").style.display="flex",p(a)}catch(t){console.error("Error loading game data:",t),document.getElementById("loadingState").style.display="none",document.getElementById("errorState").style.display="block"}}function Y(t){u[t]&&(m[t]=[...u[t]],g[t]=[])}async function F(t){if(!m[t]||m[t].length===0)return null;const e=Math.floor(Math.random()*m[t].length),c=m[t][e];m[t].splice(e,1),g[t].push(c);try{return await w(c)}catch(o){return console.error("Error fetching card by ID:",o),null}}function E(){if(!u[a])return;const t=u[a].length,e=g[a]?g[a].length:0;T.textContent=`${e}/${t}`}async function y(){if(!u[a]){n.textContent="话题数据未加载或类型不存在。";return}n.classList.remove("topic-fade-in"),n.classList.add("topic-fade-out"),setTimeout(async()=>{try{const t=await F(a);if(t===null){S();return}n.textContent=t.content,n.classList.remove("topic-fade-out"),n.classList.add("topic-fade-in"),E()}catch(t){console.error("Error displaying new topic:",t),n.textContent="加载话题失败，请重试",n.classList.remove("topic-fade-out"),n.classList.add("topic-fade-in")}},300)}function S(){const t=document.getElementById("completionModal"),e=document.getElementById("completedCount"),c=document.getElementById("currentCategoryName");e.textContent=u[a].length,c.textContent=v[a],t.classList.add("active"),document.body.style.overflow="hidden"}window.closeCompletionModal=function(){document.getElementById("completionModal").classList.remove("active"),document.body.style.overflow=""};window.restartCategory=function(){Y(a),E(),closeCompletionModal(),n.classList.remove("topic-fade-in"),n.classList.add("topic-fade-out"),setTimeout(()=>{n.textContent="点击卡片开始新一轮",n.classList.remove("topic-fade-out"),n.classList.add("topic-fade-in")},300)};function X(){if(!f[a]){console.warn("Current category data is not available.");return}const t=f[a];for(const e in f)f.hasOwnProperty(e)&&d.classList.remove(f[e].mainCardColor,f[e].mainCardTextColor);d.classList.add(t.mainCardColor,t.mainCardTextColor)}function p(t){a=t,X(),E(),n.classList.remove("topic-fade-in"),n.classList.add("topic-fade-out"),setTimeout(()=>{n.textContent="点击卡片开始",n.classList.remove("topic-fade-out"),n.classList.add("topic-fade-in")},300);const e=C.find(o=>o.dataset.categoryId===t),c=i.filter(o=>o!==t).map(o=>C.find(s=>s.dataset.categoryId===o));e&&(e.style.transform="translateY(0px) scale(1)",e.style.zIndex=50,e.style.opacity=1),c.forEach((o,s)=>{if(o){const r=s+1,L=-20,b=.05,M=.15;o.style.transform=`translateY(${r*L}px) scale(${1-r*b})`,o.style.zIndex=40-r*10,o.style.opacity=Math.max(.3,1-r*M)}})}window.goBack=function(){window.location.href="index.html"};d.addEventListener("click",t=>{t.target.closest(".category-selector")||y()});let h=0,x=0,l=!1;d.addEventListener("touchstart",t=>{h=t.touches[0].clientX,x=t.touches[0].clientY,l=!0});d.addEventListener("touchmove",t=>{l&&t.preventDefault()});d.addEventListener("touchend",t=>{if(!l)return;l=!1;const e=t.changedTouches[0].clientX,c=t.changedTouches[0].clientY,o=e-h,s=c-x;if(Math.abs(o)>Math.abs(s)&&Math.abs(o)>50){const r=i.indexOf(a);o>0&&r>0?p(i[r-1]):o<0&&r<i.length-1&&p(i[r+1])}else Math.abs(s)<30&&Math.abs(o)<30&&y()});d.addEventListener("mousedown",t=>{h=t.clientX,x=t.clientY,l=!0});d.addEventListener("mousemove",t=>{l&&t.preventDefault()});d.addEventListener("mouseup",t=>{if(!l)return;l=!1;const e=t.clientX-h,c=t.clientY-x;if(Math.abs(e)>Math.abs(c)&&Math.abs(e)>50){const o=i.indexOf(a);e>0&&o>0?p(i[o-1]):e<0&&o<i.length-1&&p(i[o+1])}else Math.abs(c)<30&&Math.abs(e)<30&&y()});B.addEventListener("click",t=>{t.stopPropagation(),y()});C.forEach(t=>{t.addEventListener("click",e=>{e.stopPropagation(),p(t.dataset.categoryId)})});document.getElementById("completionModal").addEventListener("click",function(t){t.target===this&&closeCompletionModal()});document.addEventListener("keydown",function(t){t.key==="Escape"&&closeCompletionModal()});D();
