const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/supabase-CAbq-tO9.js","assets/preload-helper-CS1eXPs2.js"])))=>i.map(i=>d[i]);
import{_ as c}from"./preload-helper-CS1eXPs2.js";let i=null,o=!1;async function d(){if(i!==null)return o;try{return i=(await c(()=>import("./supabase-CAbq-tO9.js"),__vite__mapDeps([0,1]))).supabase,o=!0,console.log("âœ… Analytics: Supabaseè¿žæŽ¥å·²å»ºç«‹"),!0}catch(n){return console.warn("âš ï¸ Analytics: Supabaseè¿žæŽ¥å¤±è´¥ï¼Œåˆ†æžåŠŸèƒ½å°†åœ¨é™é»˜æ¨¡å¼ä¸‹è¿è¡Œ:",n.message),i=null,o=!1,!1}}let t=[],a=null,l=!1;function u(){let n=localStorage.getItem("joypark_user_id");return n||(n=crypto.randomUUID(),localStorage.setItem("joypark_user_id",n)),n}async function r(){if(t.length===0||l)return;if(!await d()){console.log("ðŸ“Š Analytics: Supabaseä¸å¯ç”¨ï¼Œä¸¢å¼ƒ "+t.length+" ä¸ªäº‹ä»¶"),t=[];return}l=!0;const s=[...t];t=[],clearTimeout(a),a=null;try{if(!navigator.onLine){console.warn("ðŸ“Š Analytics: ç½‘ç»œç¦»çº¿ï¼Œåˆ†æžäº‹ä»¶å°†åœ¨ç½‘ç»œæ¢å¤åŽå‘é€"),t.unshift(...s);return}const{error:e}=await i.from("analytics_events").insert(s);e?(console.warn("ðŸ“Š Analytics Batch Error:",e),e.message&&(e.message.includes("fetch")||e.message.includes("network"))&&(console.warn("ðŸ“Š Analytics: ç½‘ç»œé”™è¯¯ï¼Œäº‹ä»¶å°†é‡æ–°åŠ å…¥é˜Ÿåˆ—"),t.unshift(...s))):console.log(`ðŸ“Š Analytics: æˆåŠŸå‘é€ ${s.length} ä¸ªåˆ†æžäº‹ä»¶`)}catch(e){console.warn("ðŸ“Š Analytics: å‘é€å¤±è´¥:",e.message),(e.name==="AbortError"||e.message.includes("fetch"))&&(console.warn("ðŸ“Š Analytics: ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œäº‹ä»¶å°†é‡æ–°åŠ å…¥é˜Ÿåˆ—"),t.unshift(...s))}finally{l=!1}}window.addEventListener("beforeunload",()=>{if(t.length>0&&navigator.sendBeacon){const n=u(),s=t.map(e=>({...e,user_id:n}));try{navigator.sendBeacon("/api/analytics",JSON.stringify(s))}catch{r()}}});document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&r()});function y(n,s={}){try{const e=u();t.push({user_id:e,event_type:n,event_data:s}),console.log(`ðŸ“Š Analytics: è¿½è¸ªäº‹ä»¶ ${n}`,s),a&&clearTimeout(a),a=setTimeout(r,3e3),t.length>=10&&r()}catch(e){console.warn("ðŸ“Š Analytics: è¿½è¸ªäº‹ä»¶å¤±è´¥:",e.message)}}function g(){return r()}function m(){return u()}export{g as flushAnalytics,m as getDebugUserId,y as trackEvent};
