import{a as L,b as v}from"./supabase-Bwuv_4SX.js";let i={},d={},m={},a="mildmode";const f=document.getElementById("topic-card"),o=document.getElementById("topic-text"),I=document.getElementById("refresh-button"),w=document.getElementById("progressIndicator"),u=Array.from(document.querySelectorAll(".category-selector")),B=["surprise","intense","ontheedge","mildmode"],C={surprise:"盲盒 Surprise Me",intense:"加麻加辣 Intense",ontheedge:"微辣 On the Edge",mildmode:"清汤 Mild Mode"},l={surprise:{mainCardColor:"bg-[#FFC9DC]",mainCardTextColor:"text-black"},intense:{mainCardColor:"bg-[#B8B4FF]",mainCardTextColor:"text-black"},ontheedge:{mainCardColor:"bg-[#A0E7E5]",mainCardTextColor:"text-black"},mildmode:{mainCardColor:"bg-[#C8FD0B]",mainCardTextColor:"text-black"}},b={surprise:{left:"calc(50% - 132px)"},intense:{left:"calc(50% - 140px)"},ontheedge:{left:"calc(50% - 148px)"},mildmode:{left:"calc(50% - 158px)"}};u.forEach(t=>{const e=t.dataset.categoryId;t.style.left=b[e].left});async function k(){try{console.log("Loading game card IDs from database...");const t=performance.now(),e=Object.keys(C).map(async s=>{console.log(`Loading card IDs for category: ${s}`);const r=await L("drinking-topics",s);return console.log(`Loaded ${r.length} card IDs for ${s}`),i[s]=r,d[s]=[...r],m[s]=[],{categoryId:s,count:r.length}}),c=await Promise.all(e),n=performance.now()-t;console.log(`All card IDs loaded in ${n.toFixed(2)}ms:`,c),document.getElementById("loadingState").style.display="none",document.getElementById("gameContainer").style.display="flex",g(a)}catch(t){console.error("Error loading game data:",t),document.getElementById("loadingState").style.display="none",document.getElementById("errorState").style.display="block"}}function T(t){i[t]&&(d[t]=[...i[t]],m[t]=[])}async function M(t){if(!d[t]||d[t].length===0)return null;const e=Math.floor(Math.random()*d[t].length),c=d[t][e];d[t].splice(e,1),m[t].push(c);try{return await v(c)}catch(n){return console.error("Error fetching card by ID:",n),null}}function p(){if(!i[a])return;const t=i[a].length,e=m[a]?m[a].length:0;w.textContent=`${e}/${t}`}async function y(){if(!i[a]){o.textContent="话题数据未加载或类型不存在。";return}o.classList.remove("topic-fade-in"),o.classList.add("topic-fade-out"),setTimeout(async()=>{try{const t=await M(a);if(t===null){D();return}o.textContent=t.content,o.classList.remove("topic-fade-out"),o.classList.add("topic-fade-in"),p()}catch(t){console.error("Error displaying new topic:",t),o.textContent="加载话题失败，请重试",o.classList.remove("topic-fade-out"),o.classList.add("topic-fade-in")}},300)}function D(){const t=document.getElementById("completionModal"),e=document.getElementById("completedCount"),c=document.getElementById("currentCategoryName");e.textContent=i[a].length,c.textContent=C[a],t.classList.add("active"),document.body.style.overflow="hidden"}window.closeCompletionModal=function(){document.getElementById("completionModal").classList.remove("active"),document.body.style.overflow=""};window.restartCategory=function(){T(a),p(),closeCompletionModal(),o.classList.remove("topic-fade-in"),o.classList.add("topic-fade-out"),setTimeout(()=>{o.textContent="点击卡片开始新一轮",o.classList.remove("topic-fade-out"),o.classList.add("topic-fade-in")},300)};function F(){if(!l[a]){console.warn("Current category data is not available.");return}const t=l[a];for(const e in l)l.hasOwnProperty(e)&&f.classList.remove(l[e].mainCardColor,l[e].mainCardTextColor);f.classList.add(t.mainCardColor,t.mainCardTextColor)}function g(t){a=t,F(),p(),o.classList.remove("topic-fade-in"),o.classList.add("topic-fade-out"),setTimeout(()=>{o.textContent="点击卡片开始",o.classList.remove("topic-fade-out"),o.classList.add("topic-fade-in")},300);const e=u.find(n=>n.dataset.categoryId===t),c=B.filter(n=>n!==t).map(n=>u.find(s=>s.dataset.categoryId===n));e&&(e.style.transform="translateY(0px) scale(1)",e.style.zIndex=50,e.style.opacity=1),c.forEach((n,s)=>{if(n){const r=s+1,x=-20,h=.05,E=.15;n.style.transform=`translateY(${r*x}px) scale(${1-r*h})`,n.style.zIndex=40-r*10,n.style.opacity=Math.max(.3,1-r*E)}})}window.goBack=function(){window.location.href="index.html"};f.addEventListener("click",t=>{t.target.closest(".category-selector")||y()});I.addEventListener("click",t=>{t.stopPropagation(),y()});u.forEach(t=>{t.addEventListener("click",e=>{e.stopPropagation(),g(t.dataset.categoryId)})});document.getElementById("completionModal").addEventListener("click",function(t){t.target===this&&closeCompletionModal()});document.addEventListener("keydown",function(t){t.key==="Escape"&&closeCompletionModal()});k();
