const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/supabase-BQMwcYa0.js","assets/preload-helper-CS1eXPs2.js"])))=>i.map(i=>d[i]);
import{_ as S}from"./preload-helper-CS1eXPs2.js";let E,C,w,l={},d={},p={},c="mildmode",m=null,i=["mildmode","ontheedge","intense","surprise"],u=!1;const L={surprise:"盲盒 Surprise Me",intense:"加麻加辣 Intense",ontheedge:"微辣 On the Edge",mildmode:"清汤 Mild Mode"};(async function(){try{const e=await S(()=>import("./supabase-BQMwcYa0.js"),__vite__mapDeps([0,1]));E=e.getGameCardIds,C=e.getCardById,w=e.getGameByCategoryTag,console.log("✅ Supabase模块加载成功"),await M()}catch(e){console.error("❌ 初始化失败:",e),document.getElementById("loadingState").style.display="none",document.getElementById("errorState").style.display="block",document.getElementById("errorState").innerHTML=`
            <p class="mb-4">游戏初始化失败</p>
            <p class="text-sm text-gray-400 mb-4">错误: ${e.message}</p>
            <button onclick="location.reload()" class="bg-red-500 text-white px-4 py-2 rounded">重试</button>
          `}})();function b(t){l[t]&&(d[t]=[...l[t]],p[t]=[])}function x(){i.forEach((t,e)=>{const o=document.querySelector(`.stacked-card[data-category='${t}']`);if(o)if(o.classList.remove("slide-left","slide-right","slide-in-from-left"),e===0)o.style.transform="translateY(0px) scale(1)",o.style.zIndex=10,o.style.opacity="1",o.style.pointerEvents="auto";else{const s=e*-15,n=1-e*.05;o.style.transform=`translateY(${s}px) scale(${n})`,o.style.zIndex=10-e,o.style.opacity="1",o.style.pointerEvents="none"}})}function g(t){if(u)return;u=!0;const e=document.querySelector(`.stacked-card[data-category='${i[0]}']`);if(!e){u=!1;return}const o=()=>{i.push(i.shift()),x(),v(),u=!1};e.classList.add("slide-right"),e.addEventListener("animationend",()=>o(),{once:!0})}function v(){c=i[0];const t=document.querySelector(`.stacked-card[data-category='${c}']`);if(!t)return;const e=t.querySelector(".topic-text");e.classList.remove("topic-fade-in"),e.classList.add("topic-fade-out"),setTimeout(()=>{e.textContent="点击卡片开始",e.classList.remove("topic-fade-out"),e.classList.add("topic-fade-in")},300)}async function k(t){if(!d[t]||d[t].length===0)return null;const e=Math.floor(Math.random()*d[t].length),o=d[t][e];d[t].splice(e,1),p[t].push(o);try{return await C(o)}catch(s){return console.error("Error fetching card by ID:",s),null}}async function h(){if(!l[c]){const o=document.querySelector(`.stacked-card[data-category='${c}']`);if(o){const s=o.querySelector(".topic-text");s.textContent="话题数据未加载或类型不存在。"}return}const t=document.querySelector(`.stacked-card[data-category='${c}']`);if(!t)return;const e=t.querySelector(".topic-text");e.classList.remove("topic-fade-in"),e.classList.add("topic-fade-out"),setTimeout(async()=>{try{const o=await k(c);if(o===null){T();return}e.textContent=o.content,e.classList.remove("topic-fade-out"),e.classList.add("topic-fade-in")}catch(o){console.error("Error displaying new topic:",o),e.textContent="加载话题失败，请重试",e.classList.remove("topic-fade-out"),e.classList.add("topic-fade-in")}},300)}function T(){const t=document.getElementById("completionModal"),e=document.getElementById("completedCount"),o=document.getElementById("currentCategoryName");e.textContent=l[c].length,o.textContent=L[c],t.classList.add("active"),document.body.style.overflow="hidden"}window.closeCompletionModal=function(){document.getElementById("completionModal").classList.remove("active"),document.body.style.overflow=""};window.restartCategory=function(){b(c),closeCompletionModal(),topicTextElement.classList.remove("topic-fade-in"),topicTextElement.classList.add("topic-fade-out"),setTimeout(()=>{topicTextElement.textContent="点击卡片开始新一轮",topicTextElement.classList.remove("topic-fade-out"),topicTextElement.classList.add("topic-fade-in")},300)};document.addEventListener("DOMContentLoaded",()=>{const t=document.querySelector(".card-stack");if(!t)return;let e=0,o=0,s=!1;t.addEventListener("mousedown",n=>{n.target.closest(".stacked-card")===document.querySelector(`.stacked-card[data-category='${i[0]}']`)&&(e=n.clientX,o=n.clientY,s=!0)}),t.addEventListener("mousemove",n=>{s&&n.preventDefault()}),t.addEventListener("mouseup",n=>{if(!s)return;s=!1;const a=n.clientX-e,r=n.clientY-o;Math.abs(a)>50||Math.abs(r)>50?g():h()}),t.addEventListener("touchstart",n=>{n.target.closest(".stacked-card")===document.querySelector(`.stacked-card[data-category='${i[0]}']`)&&(e=n.touches[0].clientX,o=n.touches[0].clientY,s=!0)}),t.addEventListener("touchend",n=>{if(!s)return;s=!1;const a=n.changedTouches[0].clientX,r=n.changedTouches[0].clientY,f=a-e,y=r-o;Math.abs(f)>50||Math.abs(y)>50?g():h()})});window.goBack=function(){window.location.href="index.html"};document.getElementById("completionModal").addEventListener("click",function(t){t.target===this&&closeCompletionModal()});document.addEventListener("keydown",function(t){t.key==="Escape"&&closeCompletionModal()});async function M(){try{console.log("Loading game data from database...");const t=performance.now(),e=new Promise((a,r)=>{setTimeout(()=>r(new Error("Database connection timeout")),1e4)});if(m=await Promise.race([w("drinking-topics"),e]),!m)throw new Error("Game not found with category_tag: drinking-topics");console.log("Game data loaded:",m);const o=Object.keys(L).map(async a=>{console.log(`Loading card IDs for category: ${a}`);try{const r=await Promise.race([E(m.id,a),new Promise((f,y)=>setTimeout(()=>y(new Error("Card loading timeout")),5e3))]);return console.log(`Loaded ${r.length} card IDs for ${a}`),l[a]=r,d[a]=[...r],p[a]=[],{categoryId:a,count:r.length}}catch(r){return console.warn(`Failed to load cards for ${a}:`,r),l[a]=[],d[a]=[],p[a]=[],{categoryId:a,count:0}}}),s=await Promise.all(o),n=performance.now()-t;console.log(`All card IDs loaded in ${n.toFixed(2)}ms:`,s),document.getElementById("loadingState").style.display="none",document.getElementById("gameContainer").style.display="flex",x(),v()}catch(t){console.error("Error loading game data:",t),document.getElementById("loadingState").style.display="none",document.getElementById("errorState").style.display="block",document.getElementById("errorState").innerHTML=`
            <p class="mb-4">加载游戏数据失败</p>
            <p class="text-sm text-gray-400 mb-4">错误: ${t.message}</p>
            <button onclick="location.reload()" class="bg-red-500 text-white px-4 py-2 rounded">重试</button>
          `}}
