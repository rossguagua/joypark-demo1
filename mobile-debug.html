<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç§»åŠ¨ç«¯è°ƒè¯• - Supabaseè¿æ¥æµ‹è¯•</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #0f0f0f; 
            color: white;
            padding: 20px;
        }
        .debug-box {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
        }
        .success { border-color: #22c55e; background: #052e16; }
        .error { border-color: #ef4444; background: #450a0a; }
        .warning { border-color: #f59e0b; background: #451a03; }
        .info { border-color: #3b82f6; background: #1e3a8a; }
        .log { 
            background: #111; 
            font-family: 'Courier New', monospace; 
            font-size: 12px;
            padding: 12px;
            border-radius: 4px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="max-w-4xl mx-auto">
        <h1 class="text-2xl font-bold mb-6">ğŸ” ç§»åŠ¨ç«¯Supabaseè¿æ¥è¯Šæ–­</h1>
        
        <!-- è®¾å¤‡ä¿¡æ¯ -->
        <div class="debug-box info">
            <h2 class="text-lg font-semibold mb-2">ğŸ“± è®¾å¤‡ä¿¡æ¯</h2>
            <div id="deviceInfo"></div>
        </div>

        <!-- ç½‘ç»œçŠ¶æ€ -->
        <div class="debug-box" id="networkStatus">
            <h2 class="text-lg font-semibold mb-2">ğŸŒ ç½‘ç»œçŠ¶æ€</h2>
            <div id="networkInfo"></div>
        </div>

        <!-- æ¨¡å—åŠ è½½æµ‹è¯• -->
        <div class="debug-box" id="moduleTest">
            <h2 class="text-lg font-semibold mb-2">ğŸ“¦ æ¨¡å—åŠ è½½æµ‹è¯•</h2>
            <div id="moduleInfo">æ­£åœ¨æµ‹è¯•...</div>
        </div>

        <!-- Supabaseè¿æ¥æµ‹è¯• -->
        <div class="debug-box" id="supabaseTest">
            <h2 class="text-lg font-semibold mb-2">ğŸ—„ï¸ Supabaseè¿æ¥æµ‹è¯•</h2>
            <div id="supabaseInfo">æ­£åœ¨æµ‹è¯•...</div>
        </div>

        <!-- æ“ä½œæŒ‰é’® -->
        <div class="debug-box">
            <h2 class="text-lg font-semibold mb-2">ğŸ® æ“ä½œ</h2>
            <div class="space-y-2">
                <button onclick="testBasicFetch()" class="bg-blue-600 text-white px-4 py-2 rounded mr-2">æµ‹è¯•åŸºç¡€ç½‘ç»œè¯·æ±‚</button>
                <button onclick="testSupabaseConnection()" class="bg-green-600 text-white px-4 py-2 rounded mr-2">é‡æ–°æµ‹è¯•Supabase</button>
                <button onclick="enableOfflineMode()" class="bg-orange-600 text-white px-4 py-2 rounded mr-2">å¼ºåˆ¶ç¦»çº¿æ¨¡å¼</button>
                <button onclick="clearLogs()" class="bg-gray-600 text-white px-4 py-2 rounded">æ¸…ç©ºæ—¥å¿—</button>
            </div>
        </div>

        <!-- å®æ—¶æ—¥å¿— -->
        <div class="debug-box">
            <h2 class="text-lg font-semibold mb-2">ğŸ“‹ å®æ—¶æ—¥å¿—</h2>
            <div id="logs" class="log"></div>
        </div>
    </div>

    <script type="module">
        let logs = [];

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            logs.push(logEntry);
            
            const logElement = document.getElementById('logs');
            logElement.textContent = logs.join('\n');
            logElement.scrollTop = logElement.scrollHeight;
            
            console.log(logEntry);
        }

        function updateStatus(elementId, content, className = '') {
            const element = document.getElementById(elementId);
            element.innerHTML = content;
            if (className) {
                element.className = element.className.replace(/\b(success|error|warning|info)\b/g, '');
                element.classList.add(className);
            }
        }

        // è®¾å¤‡ä¿¡æ¯æ£€æµ‹
        function detectDevice() {
            const info = {
                userAgent: navigator.userAgent,
                platform: navigator.platform,
                online: navigator.onLine,
                cookieEnabled: navigator.cookieEnabled,
                language: navigator.language,
                vendor: navigator.vendor,
                screen: `${screen.width}x${screen.height}`,
                viewport: `${window.innerWidth}x${window.innerHeight}`,
                pixelRatio: window.devicePixelRatio,
                connection: navigator.connection ? {
                    effectiveType: navigator.connection.effectiveType,
                    downlink: navigator.connection.downlink,
                    rtt: navigator.connection.rtt
                } : 'ä¸æ”¯æŒ'
            };

            log(`è®¾å¤‡æ£€æµ‹å®Œæˆ: ${JSON.stringify(info, null, 2)}`);
            
            const content = `
                <div><strong>ç”¨æˆ·ä»£ç†:</strong> ${info.userAgent}</div>
                <div><strong>å¹³å°:</strong> ${info.platform}</div>
                <div><strong>åœ¨çº¿çŠ¶æ€:</strong> ${info.online ? 'âœ… åœ¨çº¿' : 'âŒ ç¦»çº¿'}</div>
                <div><strong>Cookie:</strong> ${info.cookieEnabled ? 'âœ… å¯ç”¨' : 'âŒ ç¦ç”¨'}</div>
                <div><strong>è¯­è¨€:</strong> ${info.language}</div>
                <div><strong>å±å¹•:</strong> ${info.screen}</div>
                <div><strong>è§†å£:</strong> ${info.viewport}</div>
                <div><strong>åƒç´ æ¯”:</strong> ${info.pixelRatio}</div>
                <div><strong>ç½‘ç»œ:</strong> ${typeof info.connection === 'object' ? 
                    `${info.connection.effectiveType} (${info.connection.downlink}Mbps, ${info.connection.rtt}ms)` : 
                    info.connection}</div>
            `;
            updateStatus('deviceInfo', content);
        }

        // ç½‘ç»œçŠ¶æ€ç›‘æµ‹
        function setupNetworkMonitoring() {
            const updateNetwork = () => {
                const online = navigator.onLine;
                const content = `
                    <div><strong>çŠ¶æ€:</strong> ${online ? 'âœ… åœ¨çº¿' : 'âŒ ç¦»çº¿'}</div>
                    <div><strong>æ£€æµ‹æ—¶é—´:</strong> ${new Date().toLocaleString()}</div>
                `;
                updateStatus('networkInfo', content, online ? 'success' : 'error');
                log(`ç½‘ç»œçŠ¶æ€: ${online ? 'åœ¨çº¿' : 'ç¦»çº¿'}`);
            };

            window.addEventListener('online', () => {
                log('ç½‘ç»œè¿æ¥å·²æ¢å¤');
                updateNetwork();
            });

            window.addEventListener('offline', () => {
                log('ç½‘ç»œè¿æ¥å·²æ–­å¼€');
                updateNetwork();
            });

            updateNetwork();
        }

        // æ¨¡å—åŠ è½½æµ‹è¯•
        async function testModules() {
            try {
                log('å¼€å§‹æµ‹è¯•æ¨¡å—åŠ è½½...');
                
                // æµ‹è¯•import.meta.env
                let envTest = 'N/A';
                try {
                    envTest = import.meta.env ? 'âœ… å¯ç”¨' : 'âŒ ä¸å¯ç”¨';
                } catch (e) {
                    envTest = `âŒ é”™è¯¯: ${e.message}`;
                }
                
                // æµ‹è¯•ES6æ¨¡å—
                const moduleTest = await import('./src/lib/supabase.js');
                log('Supabaseæ¨¡å—åŠ è½½æˆåŠŸ');
                
                const content = `
                    <div><strong>import.meta.env:</strong> ${envTest}</div>
                    <div><strong>ES6æ¨¡å—:</strong> âœ… æ”¯æŒ</div>
                    <div><strong>Supabaseæ¨¡å—:</strong> âœ… åŠ è½½æˆåŠŸ</div>
                `;
                updateStatus('moduleInfo', content, 'success');
                
                return moduleTest;
            } catch (error) {
                log(`æ¨¡å—åŠ è½½å¤±è´¥: ${error.message}`);
                const content = `
                    <div><strong>é”™è¯¯:</strong> ${error.message}</div>
                    <div><strong>å †æ ˆ:</strong> <pre style="font-size: 10px; margin-top: 8px;">${error.stack}</pre></div>
                `;
                updateStatus('moduleInfo', content, 'error');
                return null;
            }
        }

        // Supabaseè¿æ¥æµ‹è¯•
        async function testSupabase() {
            try {
                log('å¼€å§‹æµ‹è¯•Supabaseè¿æ¥...');
                
                const supabaseModule = await import('./src/lib/supabase.js');
                log('Supabaseæ¨¡å—å¯¼å…¥æˆåŠŸ');
                
                // æµ‹è¯•ç®€å•æŸ¥è¯¢
                const games = await supabaseModule.getGames();
                log(`SupabaseæŸ¥è¯¢æˆåŠŸï¼Œè·å–åˆ° ${games.length} ä¸ªæ¸¸æˆ`);
                
                const content = `
                    <div><strong>æ¨¡å—å¯¼å…¥:</strong> âœ… æˆåŠŸ</div>
                    <div><strong>æ•°æ®åº“æŸ¥è¯¢:</strong> âœ… æˆåŠŸ</div>
                    <div><strong>æ¸¸æˆæ•°é‡:</strong> ${games.length}</div>
                    <div><strong>æµ‹è¯•æ—¶é—´:</strong> ${new Date().toLocaleString()}</div>
                `;
                updateStatus('supabaseInfo', content, 'success');
                
            } catch (error) {
                log(`Supabaseè¿æ¥å¤±è´¥: ${error.message}`);
                const content = `
                    <div><strong>é”™è¯¯:</strong> ${error.message}</div>
                    <div><strong>ç±»å‹:</strong> ${error.name}</div>
                    <div><strong>è¯¦æƒ…:</strong> <pre style="font-size: 10px; margin-top: 8px;">${error.stack}</pre></div>
                `;
                updateStatus('supabaseInfo', content, 'error');
            }
        }

        // åŸºç¡€ç½‘ç»œæµ‹è¯•
        window.testBasicFetch = async function() {
            try {
                log('å¼€å§‹åŸºç¡€ç½‘ç»œæµ‹è¯•...');
                const response = await fetch('https://httpbin.org/json', { 
                    method: 'GET',
                    headers: { 'Accept': 'application/json' }
                });
                const data = await response.json();
                log(`åŸºç¡€ç½‘ç»œæµ‹è¯•æˆåŠŸ: ${JSON.stringify(data)}`);
            } catch (error) {
                log(`åŸºç¡€ç½‘ç»œæµ‹è¯•å¤±è´¥: ${error.message}`);
            }
        };

        // é‡æ–°æµ‹è¯•Supabase
        window.testSupabaseConnection = function() {
            testSupabase();
        };

        // å¼ºåˆ¶ç¦»çº¿æ¨¡å¼
        window.enableOfflineMode = function() {
            localStorage.setItem('forceOfflineMode', 'true');
            log('å·²å¼ºåˆ¶å¯ç”¨ç¦»çº¿æ¨¡å¼');
            alert('ç¦»çº¿æ¨¡å¼å·²å¯ç”¨ï¼Œè¯·è¿”å›æ¸¸æˆé¡µé¢æµ‹è¯•');
        };

        // æ¸…ç©ºæ—¥å¿—
        window.clearLogs = function() {
            logs = [];
            document.getElementById('logs').textContent = '';
        };

        // åˆå§‹åŒ–
        log('ğŸš€ ç§»åŠ¨ç«¯è¯Šæ–­å·¥å…·å¯åŠ¨');
        detectDevice();
        setupNetworkMonitoring();
        
        // å»¶è¿Ÿæµ‹è¯•æ¨¡å—å’ŒSupabase
        setTimeout(async () => {
            await testModules();
            await testSupabase();
        }, 1000);
    </script>
</body>
</html> 